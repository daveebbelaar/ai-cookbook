# ادغام Openai با MCP

در این بخش نحوه ادغام پروتکل زمینه مدل (MCP) با API OpenAI برای ایجاد سیستمی که OpenAI می تواند به ابزارهای ارائه شده توسط سرور MCP شما دسترسی داشته باشد ، نشان می دهد.

## بررسی اجمالی

این مثال نحوه:

1. یک سرور MCP ایجاد کنید که یک ابزار پایه دانش را در معرض دید خود قرار دهد
2. OpenAi را به این سرور MCP وصل کنید
3. اجازه دهید OpenAi هنگام پاسخ به نمایش داده های کاربر ، از ابزارها به صورت پویا استفاده کند

## روش اتصال

این مثال از ** Stdio Transport ** برای برقراری ارتباط بین مشتری و سرور استفاده می کند ، به این معنی است که:

- مشتری و سرور در همان فرآیند اجرا می شوند
- مشتری مستقیماً سرور را به عنوان یک زیرمجموعه راه اندازی می کند
- هیچ فرآیند سرور جداگانه ای لازم نیست

اگر می خواهید مشتری و سرور خود را به برنامه های جداگانه تقسیم کنید (به عنوان مثال ، اجرای سرور بر روی یک دستگاه دیگر) ، باید به جای آن از Transport ** SSE (رویدادهای سرور-SENT) استفاده کنید.برای جزئیات بیشتر در مورد تنظیم اتصال SSE ، به بخش [Simple Server Setup] (../ 3-Simple-Server-Server-Setup) مراجعه کنید.

### توضیح جریان داده

1. ** پرس و جو کاربر **: کاربر پرس و جو را به سیستم می فرستد (به عنوان مثال ، "سیاست تعطیلات شرکت ما چیست؟")
2. ** OpenAi API **: OpenAI پرس و جو و ابزارهای موجود را از سرور MCP دریافت می کند
3. ** انتخاب ابزار **: OpenAI تصمیم می گیرد که از چه ابزارهایی برای استفاده بر اساس پرس و جو استفاده کنید
4. ** MCP Client **: مشتری درخواست تماس ابزار OpenAI را دریافت می کند و آن را به سرور MCP ارسال می کند
5. ** سرور MCP **: سرور ابزار درخواست شده را اجرا می کند (به عنوان مثال ، بازیابی داده های پایه دانش)
6. ** جریان پاسخ **: نتیجه ابزار از طریق مشتری MCP به OpenAI باز می گردد
7. ** پاسخ نهایی **: OpenAI پاسخ نهایی را شامل داده های ابزار ایجاد می کند

## چگونه OpenAI ابزارها را اجرا می کند

مکانیسم فراخوانی عملکرد OpenAI با این مراحل با ابزارهای MCP کار می کند:

1. ** ثبت نام ابزار **: مشتری MCP ابزارهای MCP را به فرمت عملکرد OpenAi تبدیل می کند
2. ** انتخاب ابزار **: OpenAI تصمیم می گیرد که از چه ابزارهایی برای استفاده بر اساس پرس و جو کاربر استفاده کنید
3. ** اجرای ابزار **: مشتری MCP ابزارهای انتخاب شده را اجرا می کند و نتایج را باز می گرداند
4. ** ادغام زمینه **: OpenAI نتایج ابزار را در پاسخ خود گنجانده است

## نقش MCP

MCP به عنوان یک پل استاندارد بین مدل های AI و سیستم های باطن شما عمل می کند:

- ** استاندارد سازی **: MCP یک رابط سازگار برای مدل های AI برای تعامل با ابزارها فراهم می کند
- ** انتزاع **: MCP پیچیدگی سیستم های باطن شما را از بین می برد
- ** امنیت **: MCP به شما امکان می دهد دقیقاً آنچه را که ابزارها و داده ها در معرض مدل های AI قرار دارند ، کنترل کنید
- ** انعطاف پذیری **: شما می توانید بدون تغییر ادغام AI ، اجرای پس زمینه خود را تغییر دهید

## جزئیات اجرای

### سرور (`server.py`)

سرور MCP یک ابزار `get_nydledge_base را در معرض نمایش قرار می دهد که جفت پرسش و پاسخ را از یک فایل JSON بازیابی می کند.

### مشتری (`client.py`)

مشتری:

1. به سرور MCP متصل می شود
2. ابزارهای MCP را به فرمت عملکرد OpenAi تبدیل می کند
3. ارتباط بین OpenAI و سرور MCP را کنترل می کند
4. نتایج ابزار را پردازش می کند و پاسخ های نهایی را ایجاد می کند

### پایگاه دانش (`data/kb.json`)

حاوی جفت پرسش و پاسخ در مورد خط مشی های شرکت است که می تواند از طریق سرور MCP پرسیده شود.

## اجرای مثال

1. اطمینان حاصل کنید که وابستگی های لازم را نصب کرده اید
2. کلید API OpenAi خود را در پرونده `.env` تنظیم کنید
3. مشتری را اجرا کنید: `python client.py`

توجه: با حمل و نقل STDIO که در این مثال استفاده شده است ، نیازی به اجرای سرور به طور جداگانه نیست زیرا مشتری به طور خودکار آن را شروع می کند.